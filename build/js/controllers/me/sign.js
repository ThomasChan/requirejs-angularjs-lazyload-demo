window.application.components.controller("SignCtrl",["$rootScope","$scope","$location","$cookies","$timeout","API",function(e,r,n,t,o,i){switch(i.isLogin()&&n.path("/me"),n.path()){case"/me/signin":r.signTabs="登录取经";break;case"/me/signup":r.signTabs="注册取经"}r.tabsChange=function(n){r.signTabs=n,e.$broadcast("signTabChange",n)},r.login=i.login.params,r.loginFormServerError="",r.doLogin=function(){console.log(r.login),r.loginFormServerError="",i.go(i.login,r.login).then(function(e){e.data.expire_time;t.put("is_login",!0,{expires:new Date(+new Date+6e6)}),i.go(i.getUserCenterData).then(function(e){t.putObject("user",e.data),i.go(i.getMentorInfo).then(function(e){e.data.mt_validate&&t.put("is_mentor",!0)},function(e){})},function(e){}),n.path("/me")},function(e){r.loginFormServerError=e.data})},r.register=i.register.params,r.registerFormServerError="",r.timer=null,r.requireSms={text_when_sms:"发送验证码",counter:60,start:!1,countDown:function(){r.timer=o(function(){r.requireSms.counter>0&&r.requireSms.start?(r.requireSms.counter--,r.requireSms.text_when_sms=r.requireSms.counter+" 秒后重新获取",r.requireSms.countDown()):(r.requireSms.start=!1,r.requireSms.text_when_sms="重新获取验证码",r.requireSms.counter=60,o.cancel(r.timer)),console.log("counter...",r.requireSms.counter)},1e3)},"do":function(){console.log("start..."),i.go(i.sendPhoneVcode,{phone:r.register.phone}).then(function(e){r.requireSms.start=!0,r.requireSms.countDown()},function(e){r.registerFormServerError=e})}},r.$on("$locationChangeStart",function(e){o.cancel(r.timer)}),r.doRegister=function(){console.log(r.register),i.go(i.register,r.register).then(function(e){t.put("is_login",!0,{expires:new Date(+new Date+6e6)}),t.putObject("user",e.data,{expires:new Date(+new Date+6e6)}),n.path("/me")},function(e){r.registerFormServerError=e.data})}}]);